document.body.setAttribute("data-version",chrome.runtime.getManifest().version);let e=null;chrome.storage.local.get(["queue"],(async({queue:t})=>{t?(t.tabId=await new Promise((t=>{chrome.runtime.sendMessage({cmd:"GET_TAB_ID",parameter:{}},(a=>{e=new BroadcastChannel(`channel-${a}`),e.addEventListener("message",(t=>{const{id:a,cmd:s,data:r,response:n}=t.data;if("GET_ALL_STORAGE"!==s)chrome.runtime.sendMessage({cmd:s,parameter:r},(t=>{n&&e.postMessage({id:a,data:t})}));else{const{storageKey:t}=r;chrome.storage.local.get([t],(s=>{0!==Object.keys(s).length&&(s=s[t]),n&&e.postMessage({id:a,data:s})}))}})),window.addEventListener("beforeunload",(function(){e.close()})),t(a)}))})),chrome.storage.local.remove(["queue"])):t=null;if(new BroadcastChannel("fetchv-temporary-channel").postMessage(t?JSON.stringify(t):t),t)if("rec"!==t.type)chrome.storage.local.get(["tasks"],(({tasks:e})=>{e||(e=[]),e.push({tabId:t.tabId,url:t.url}),chrome.storage.local.set({tasks:e})}));else{let a=!1;chrome.runtime.onMessage.addListener((function(t,s,r){const{cmd:n,parameter:o}=t;if("REC_ON_DATA"===n){const{data:t}=o;return t.url?fetch(t.url).then((e=>{if(e.ok)return e.arrayBuffer()})).then((a=>{URL.revokeObjectURL(t.url),t.url=URL.createObjectURL(new Blob([new Uint8Array(a)])),e&&e.postMessage({id:n,data:t})})):e&&e.postMessage({id:n,data:t}),a||(a=!0),r(),!0}if("REC_STOP"===n)return a=!1,e&&e.postMessage({id:n}),r(),!0})),window.addEventListener("beforeunload",(e=>{a&&chrome.runtime.sendMessage({cmd:"REC_STOP",parameter:{tabId:t.targetTab}})}))}}));