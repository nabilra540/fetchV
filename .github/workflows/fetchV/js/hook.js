(()=>{let e=!1,t=localStorage.getItem("fv_recorder_tab");if(!t)return;t=parseInt(t);const r=new BroadcastChannel(`channel-${t}`);function n(e,t){return Math.floor(Math.random()*(t-e+1))+e}r.addEventListener("message",(t=>{"REC_STOP"===t.data.cmd&&(e=!0)}));const o=window.MediaSource;window.MediaSource=new Proxy(o,{construct(t,o){const c=n(1e3,2e8),a=new t(...o);return a.addEventListener("sourceended",(()=>{e||r.postMessage({url:null})})),a.addSourceBuffer=new Proxy(a.addSourceBuffer,{apply(t,o,a){const u=n(1e3,2e8),i=a[0],s=t.apply(o,a);return s.appendBuffer=new Proxy(s.appendBuffer,{apply(t,n,o){if(!e&&o.length>0){const e=o[0];if(e.length>0||e.byteLength>0){const t=new Blob([e]),n=URL.createObjectURL(t);r.postMessage({url:n,mime:i,mid:c,bid:u}),setTimeout((function(){URL.revokeObjectURL(n)}),1e4)}}return t.apply(n,o)}}),s}}),a}});const c=Object.getOwnPropertyDescriptor(HTMLMediaElement.prototype,"currentTime").get,a=Object.getOwnPropertyDescriptor(HTMLMediaElement.prototype,"currentTime").set;let u,i=!1,s=!1;setTimeout((()=>{s=!0}),1e4),Object.defineProperty(HTMLMediaElement.prototype,"currentTime",{get:function(){return c.call(this)},set:function(e){return s||(i?null!==u&&(e=0):(e=0,i=!0,u=setTimeout((()=>{u=null}),1e3))),a.call(this,e)}})})();