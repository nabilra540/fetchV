let e=null,t=null,o=null;try{e=localStorage.getItem("fv_recorder_tab")}catch(e){}if(e){e=parseInt(e),setTimeout((()=>{localStorage.removeItem("fv_recorder_tab")}),5e3),t=new BroadcastChannel(`channel-${e}`),t.addEventListener("message",(t=>{if(t.origin===location.origin&&(chrome.runtime.sendMessage({cmd:"REC_ON_DATA",parameter:{recorderTab:e,data:t.data}}),null===o))try{const e=window.top.document;o=e.createElement("div"),o.style.width="100%",o.style.height="100%",o.style.position="fixed",o.style.bottom=0,o.style.right=0,o.style.zIndex=99999999,o.style.pointerEvents="none";const t=new Image;t.width=150,t.height=150,t.src=chrome.runtime.getURL("img/recording.svg"),t.style.position="absolute",t.style.right="10px",t.style.bottom="10px",o.appendChild(t),e.body.appendChild(o)}catch(e){o=!1}}));const r=document.createElement("script");r.src=chrome.runtime.getURL("js/hook.js"),document.documentElement.appendChild(r),window.addEventListener("beforeunload",(o=>{try{chrome.runtime.sendMessage({cmd:"REC_STOP",parameter:{tabId:e}}),t&&t.close(),localStorage.removeItem("fv_recorder_tab")}catch(e){}}))}chrome.runtime.onMessage.addListener((function(e,r,n){const{cmd:a,parameter:c}=e;if("REC_START"===a)return localStorage.setItem("fv_recorder_tab",c.tab),document.querySelectorAll('video[src^="blob:"]').forEach((e=>{e.currentTime=0})),setTimeout((()=>{self===top&&(n(),window.location.reload())}),500),!0;if("REC_STOP"===a)return t&&t.postMessage({cmd:a}),o&&o.remove(),n(),!0;if("REC_SPEED_UP"===a){const{speed:e}=c;return document.querySelectorAll('video[src^="blob:"]').forEach((t=>{isNaN(t.duration)||(t.playbackRate=e)})),n(),!0}}));